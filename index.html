<!-- ... código acima igual ... -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp, doc, updateDoc, deleteDoc } 
    from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, RecaptchaVerifier, signInWithPhoneNumber, signOut, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { firebaseConfig } from "./firebase-config.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const formSection = document.getElementById("publicar");
  const form = document.getElementById("form-publicar");
  const lista = document.getElementById("lista");
  const btnLogin = document.getElementById("btn-login");
  const btnPublicar = document.getElementById("btn-publicar");

  let currentUser = null;
  let confirmationResult = null;

  // ⚡ Cloudinary Config (teu)
  const cloudName = "dyylw9hjm"; 
  const uploadPreset = "ml_default"; 

  // ... restante do código igual ...

  // Publicar ou Editar
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!currentUser) {
      alert("Precisas de estar logado para publicar.");
      return;
    }

    const tipo = document.getElementById("tipo").value;
    const categoria = document.getElementById("categoria").value;
    const titulo = document.getElementById("titulo").value;
    const descricao = document.getElementById("descricao").value;
    const contacto = document.getElementById("contacto").value;
    const foto = document.getElementById("foto").files[0];

    let fotoURL = "";
    if (foto) {
      const formData = new FormData();
      formData.append("file", foto);
      formData.append("upload_preset", uploadPreset);

      const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
        method: "POST",
        body: formData
      });

      const data = await response.json();
      fotoURL = data.secure_url;
    }

    if (form.dataset.editId) {
      const docRef = doc(db, "items", form.dataset.editId);
      await updateDoc(docRef, {
        tipo, categoria, titulo, descricao, contacto,
        ...(fotoURL && { fotoURL })
      });
      delete form.dataset.editId;
      alert("Anúncio atualizado com sucesso ✅");
    } else {
      await addDoc(collection(db, "items"), {
        uid: currentUser.uid,
        autor: currentUser.displayName || currentUser.phoneNumber || "Anónimo",
        tipo, categoria, titulo, descricao, contacto,
        fotoURL, destaque: false, resolvido: false,
        created_at: serverTimestamp()
      });
    }

    form.reset();
    carregarItens();
    document.getElementById("feed").scrollIntoView({ behavior: "smooth" });
  });

  // ... restante do código igual ...
</script>

<!-- ... código abaixo igual ... -->

