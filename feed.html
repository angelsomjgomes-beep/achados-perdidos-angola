<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feed — Achados & Perdidos Angola</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .navy { background-color: #0a192f; }
    .navy-btn { background-color: #0a192f; }
    .navy-btn:hover { background-color: #112240; }
    .badge { background-color: #0a192f; color: white; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="navy text-white p-4 shadow dark:bg-gray-800">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-2 font-bold text-xl">
        <i data-lucide="search" class="w-6 h-6"></i> Achados & Perdidos
      </a>
      <nav class="flex items-center gap-6 text-sm font-medium">
        <a href="index.html" class="hover:underline">🏠 Início</a>
        <a href="feed.html" class="underline font-semibold">📰 Feed</a>
        <a href="publicar.html" class="hover:underline">➕ Publicar</a>
        <a href="sobre.html" class="hover:underline">ℹ️ Sobre</a>
        <a href="perfil.html" class="hover:underline">👤 Perfil</a>
      </nav>
    </div>
  </header>

  <!-- Conteúdo -->
  <main class="flex-1 max-w-5xl mx-auto w-full p-6">
    <h1 class="text-3xl font-bold text-center text-blue-900 dark:text-blue-300 mb-8">Itens Perdidos e Encontrados</h1>
    <div id="feed" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <p id="sem-itens" class="hidden text-center text-gray-500 mt-6">Nenhum item publicado ainda 😔</p>
  </main>

  <footer class="navy text-white p-6 text-center dark:bg-gray-800 mt-8">
    © <span id="ano"></span> Achados & Perdidos Angola
  </footer>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { firebaseConfig } from "./firebase-config.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const feed = document.getElementById("feed");
    const semItens = document.getElementById("sem-itens");

    async function carregarFeed(userId = null) {
      Swal.fire({ title: '🔄 A carregar...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      try {
        const q = query(collection(db, "items"), orderBy("created_at", "desc"));
        const snap = await getDocs(q);
        Swal.close();

        if (snap.empty) {
          semItens.classList.remove("hidden");
          return;
        }

        feed.innerHTML = "";

        // Itens do utilizador logado primeiro
        const meus = [];
        const outros = [];

        snap.forEach((docSnap) => {
          const it = docSnap.data();
          if (it.uid === userId) meus.push(it);
          else outros.push(it);
        });

        const todos = [...meus, ...outros];
        todos.forEach((it) => {
          const card = document.createElement("div");
          card.className = "bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg shadow hover:shadow-lg p-4 transition";
          card.innerHTML = `
            ${it.fotoURL ? `<img src="${it.fotoURL}" class="w-full h-48 object-cover rounded-lg mb-3">` : ""}
            <div class="flex justify-between items-center">
              <h2 class="text-lg font-semibold">${it.titulo}</h2>
              ${it.uid === userId ? `<span class="badge">Publicado por mim</span>` : ""}
            </div>
            <p class="text-sm text-gray-500">${it.categoria} • ${it.tipo}</p>
            <p class="mt-2 text-sm">${it.descricao || ""}</p>
            <div class="mt-4 flex justify-between items-center">
              <a href="https://wa.me/${it.telefone || ''}" target="_blank"
                 class="px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded">📱 Contactar</a>
              <button class="reportar text-xs text-red-500 hover:underline">🚩 Reportar</button>
            </div>
          `;
          feed.appendChild(card);

          // Evento de reportar
          card.querySelector(".reportar").addEventListener("click", () => {
            Swal.fire({
              icon: 'info',
              title: 'Reportar item',
              text: 'Esta funcionalidade estará disponível em breve.',
              confirmButtonText: 'OK'
            });
          });
        });
      } catch (err) {
        Swal.fire('❌ Erro', 'Não foi possível carregar o feed.', 'error');
        console.error(err);
      }
    }

    // Espera pelo estado do login
    onAuthStateChanged(auth, (user) => {
      const uid = user ? user.uid : null;
      carregarFeed(uid);
    });

    document.getElementById("ano").textContent = new Date().getFullYear();
    lucide.createIcons();
  </script>
</body>
</html>


